<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KiteAI Community Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(180deg, #0a0e17, #1a2338);
            font-family: 'Orbitron', sans-serif;
            color: #e0e7ff;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            position: relative;
        }

        /* Background Animation */
        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        .particle {
            position: absolute;
            width: 5px;
            height: 5px;
            background: #3b82f6;
            border-radius: 50%;
            animation: floatParticle 10s linear infinite;
            opacity: 0.4;
        }
        .particle:nth-child(1) { top: 10%; left: 20%; animation-delay: 0s; }
        .particle:nth-child(2) { top: 40%; left: 60%; animation-delay: 2s; }
        .particle:nth-child(3) { top: 60%; left: 30%; animation-delay: 4s; }
        .particle:nth-child(4) { top: 80%; left: 70%; animation-delay: 6s; }
        @keyframes floatParticle {
            0% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(30px, -30px) scale(1.3); }
            100% { transform: translate(0, 0) scale(1); }
        }

        /* Navigation */
        .top-nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(10, 14, 23, 0.9);
            backdrop-filter: blur(8px);
            padding: 0.7rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);
        }
        .logo img {
            height: 1.8rem;
            border-radius: 5px;
            transition: transform 0.3s ease;
        }
        .logo img:hover { transform: scale(1.1); }
        .nav-links {
            display: flex;
            gap: 0.7rem;
        }
        .nav-links a, .dropbtn {
            color: #e0e7ff;
            text-decoration: none;
            font-size: 0.8rem;
            padding: 0.4rem 0.7rem;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        .nav-links a:hover, .dropbtn:hover {
            background: #3b82f6;
            color: #fff;
            transform: translateY(-2px);
        }
        .dropdown { position: relative; }
        .dropdown-content {
            display: none;
            position: absolute;
            top: 1.8rem;
            background: rgba(10, 14, 23, 0.95);
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            min-width: 150px;
            padding: 0.3rem 0;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        .dropdown:hover .dropdown-content, .dropdown:focus-within .dropdown-content {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        .dropdown-content a {
            display: block;
            padding: 0.3rem 0.7rem;
            font-size: 0.75rem;
        }

        /* Sidebar (Mobile) */
        .sidebar-btn {
            display: none;
            font-size: 1.3rem;
            background: none;
            border: none;
            color: #e0e7ff;
            cursor: pointer;
            padding: 0.3rem;
            border-radius: 5px;
        }
        .sidebar-btn:hover { background: rgba(59, 130, 246, 0.2); }
        .sidebar {
            position: fixed;
            top: 0;
            left: -100%;
            width: 75%;
            height: 100%;
            background: rgba(10, 14, 23, 0.95);
            padding: 1.2rem 0.7rem;
            z-index: 999;
            transition: left 0.3s ease;
        }
        .sidebar.show { left: 0; }
        .sidebar a {
            color: #e0e7ff;
            text-decoration: none;
            padding: 0.5rem;
            margin: 0.2rem 0;
            border-radius: 5px;
            display: block;
            transition: all 0.3s ease;
        }
        .sidebar a:hover { background: #3b82f6; transform: translateX(5px); }
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 998;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .sidebar-overlay.show { display: block; opacity: 1; }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal.show { display: flex; opacity: 1; }
        .modal-content {
            background: #1a2338;
            border-radius: 8px;
            padding: 1rem;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 12px rgba(59, 130, 246, 0.5);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal.show .modal-content { transform: scale(1); }
        .modal-close {
            position: absolute;
            top: 0.7rem;
            right: 0.7rem;
            width: 1rem;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .modal-close:hover { transform: scale(1.2); }

        /* Games Modal */
        #gamesModal .modal-content { text-align: center; }
        .game-option {
            display: block;
            padding: 0.5rem;
            margin: 0.3rem auto;
            background: linear-gradient(45deg, #3b82f6, #60a5fa);
            color: #fff;
            text-decoration: none;
            border-radius: 5px;
            width: 80%;
            max-width: 180px;
            transition: all 0.3s ease;
        }
        .game-option:hover { transform: scale(1.05); background: linear-gradient(45deg, #60a5fa, #3b82f6); }

        /* Announcement Modal */
        #announcementModal .modal-content { background: #fff; color: #000; }
        .announcement-controls {
            display: flex;
            justify-content: center;
            gap: 0.7rem;
            margin-top: 0.7rem;
        }
        .announcement-controls span {
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .announcement-controls span:hover { color: #3b82f6; transform: scale(1.2); }

        /* Flipping Game */
        #gameContent { max-width: 550px; }
        #gameTitle { font-size: 1.3rem; text-align: center; margin-bottom: 0.7rem; }
        #puzzleGrid { display: grid; gap: 0.3rem; margin-bottom: 0.7rem; }
        .card {
            position: relative;
            width: 100%;
            padding-top: 100%;
            cursor: pointer;
            perspective: 1000px;
        }
        .card-inner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: transform 0.5s ease;
            transform-style: preserve-3d;
        }
        .card.flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .card-front { transform: rotateY(180deg); }
        .card-back { background: #334155; }
        .card img { width: 100%; height: 100%; object-fit: cover; border-radius: 5px; }
        .game-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.7rem;
        }
        #gameScore { font-size: 0.8rem; padding: 0.3rem 0.7rem; background: rgba(10, 14, 23, 0.8); border-radius: 5px; }
        #restartGameBtn, #nextLevelBtn {
            padding: 0.3rem 0.7rem;
            background: linear-gradient(45deg, #3b82f6, #60a5fa);
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #restartGameBtn:hover, #nextLevelBtn:hover { transform: scale(1.05); }
        #winMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(10, 14, 23, 0.9);
            padding: 0.7rem 1.4rem;
            border-radius: 5px;
            font-size: 1.2rem;
            opacity: 0;
            transition: all 0.5s ease;
        }
        #winMessage.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }

        /* Shooting Game */
        #shootingGameContent { max-width: 600px; }
        #shootingGameTitle { font-size: 1.3rem; text-align: center; margin-bottom: 0.7rem; }
        #shootingGameCanvas {
            width: 100%;
            max-width: 600px;
            height: 400px;
            background: linear-gradient(180deg, #1a2338, #334155);
            border-radius: 5px;
            border: 2px solid #3b82f6;
            position: relative;
            cursor: crosshair;
        }
        .game-controls-shooting { display: flex; justify-content: space-between; margin-bottom: 0.7rem; }
        #shootingGameScore { font-size: 0.8rem; padding: 0.3rem 0.7rem; background: rgba(10, 14, 23, 0.8); border-radius: 5px; }
        #scopeToggleBtn, #restartShootingGameBtn {
            padding: 0.3rem 0.7rem;
            background: linear-gradient(45deg, #3b82f6, #60a5fa);
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #scopeToggleBtn:hover, #restartShootingGameBtn:hover { transform: scale(1.05); }
        #gameOverMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(10, 14, 23, 0.9);
            padding: 0.7rem 1.4rem;
            border-radius: 5px;
            font-size: 1.2rem;
            opacity: 0;
            transition: all 0.5s ease;
        }
        #gameOverMessage.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        .hit-effect {
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, rgba(255, 0, 0, 0.8), transparent);
            border-radius: 50%;
            animation: hitFade 0.5s ease-out forwards;
        }
        @keyframes hitFade {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        /* Feedback Form */
        .feedback-form {
            background: #1a2338;
            padding: 1rem;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            margin: 0.8rem;
            box-shadow: 0 0 12px rgba(59, 130, 246, 0.5);
            transition: transform 0.3s ease;
        }
        .feedback-form:hover { transform: scale(1.02); }
        .feedback-form h2 { font-size: 1.3rem; margin-bottom: 0.7rem; }
        select, textarea, input {
            width: 100%;
            padding: 0.5rem;
            margin: 0.3rem 0;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: #334155;
            color: #e0e7ff;
            font-size: 0.8rem;
            transition: border-color 0.3s ease;
        }
        select:focus, textarea:focus, input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 5px rgba(59, 130, 246, 0.3);
            outline: none;
        }
        .form-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); gap: 0.3rem; margin-top: 0.7rem; }
        .form-buttons button {
            padding: 0.5rem;
            background: linear-gradient(45deg, #3b82f6, #60a5fa);
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .form-buttons button:hover { transform: scale(1.05); }
        .form-buttons button:disabled { background: #4b5563; cursor: not-allowed; transform: none; }

        /* Agent Chat */
        #agentContent { display: flex; flex-direction: column; gap: 0.7rem; }
        #chatMessages {
            flex-grow: 1;
            background: #334155;
            border-radius: 5px;
            padding: 0.7rem;
            overflow-y: auto;
            max-height: 40vh;
        }
        .chat-msg {
            margin: 0.3rem;
            padding: 0.5rem;
            border-radius: 5px;
            max-width: 80%;
        }
        .chat-agent { background: #3b82f6; color: #fff; align-self: flex-start; }
        .chat-user { background: #475569; color: #fff; align-self: flex-end; }
        #preQuestions { display: flex; flex-wrap: wrap; gap: 0.3rem; margin-bottom: 0.7rem; }
        .question-btn {
            padding: 0.3rem 0.7rem;
            background: #3b82f6;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .question-btn:hover { background: #60a5fa; transform: scale(1.05); }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 0.7rem;
            left: 50%;
            transform: translateX(-50%) scale(0.95);
            background: #3b82f6;
            color: #fff;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            opacity: 0;
            transition: all 0.3s ease;
        }
        .toast.show { opacity: 1; transform: translateX(-50%) scale(1); }

        /* Footer */
        footer {
            position: fixed;
            bottom: 0.3rem;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.7rem;
            color: #e0e7ff;
            background: rgba(10, 14, 23, 0.9);
            padding: 0.3rem;
            border-radius: 5px;
            z-index: 10;
        }
        footer img {
            height: 0.9rem;
            border-radius: 3px;
        }
        footer a { color: #3b82f6; text-decoration: none; }
        footer a:hover { color: #60a5fa; }

        /* Visually Hidden */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        /* Mobile Styles */
        @media (max-width: 767px) {
            .nav-links { display: none; }
            .sidebar-btn { display: block; }
            .feedback-form { padding: 0.7rem; max-width: 95%; }
            .form-buttons { grid-template-columns: 1fr; }
            #puzzleGrid { gap: 0.2rem; }
            #gameTitle, #shootingGameTitle { font-size: 1rem; }
            #gameScore, #shootingGameScore { font-size: 0.7rem; }
            #shootingGameCanvas { height: 250px; }
            .game-option { width: 85%; }
            .modal-content { padding: 0.7rem; }
        }
        @media (min-width: 768px) {
            .sidebar-btn, .sidebar, .sidebar-overlay { display: none; }
        }
    </style>
</head>
<body>
    <!-- Background Animation -->
    <div class="background-animation">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Audio -->
    <audio id="clickSound" src="https://cdn.pixabay.com/audio/2022/03/10/audio_5b3d3b4213.mp3" preload="auto"></audio>
    <audio id="shootSound" src="https://cdn.pixabay.com/audio/2023/02/13/audio_1d7a4e7a53.mp3" preload="auto"></audio>

    <!-- Navigation -->
    <nav class="top-nav">
        <div class="logo">
            <img src="https://i.postimg.cc/mzMZpf0r/logo.jpg" alt="KiteAI Logo">
        </div>
        <div class="nav-links">
            <a href="https://testnet.gokite.ai?referralCode=XDO80HYV" target="_blank" aria-label="KiteAI Testnet">Testnet</a>
            <a href="https://opensea.io/collection/fly-the-kite-official" target="_blank" aria-label="KiteAI NFTs">NFTs</a>
            <div class="dropdown">
                <button class="dropbtn" aria-label="Community Menu" tabindex="0">Community</button>
                <div class="dropdown-content">
                    <a href="https://x.com/ChiZhangData" target="_blank">Co-founder</a>
                    <a href="https://x.com/Kite_Frens_Eco" target="_blank">Community & Ecosystem</a>
                    <a href="https://x.com/KiteAIChinese" target="_blank">KiteAI Chinese</a>
                </div>
            </div>
            <div class="dropdown">
                <button class="dropbtn" aria-label="Team Menu" tabindex="0">Team</button>
                <div class="dropdown-content">
                    <a href="https://x.com/buidloor" target="_blank">Vikthebuilder</a>
                    <a href="https://x.com/lei_lei0904" target="_blank">Lei-Lei</a>
                    <a href="https://x.com/scottshics" target="_blank">Scott Shi</a>
                    <a href="https://x.com/Henryleemr" target="_blank">Henry Lee</a>
                    <a href="https://x.com/superamscom" target="_blank">Spring</a>
                    <a href="https://x.com/0xLaughing" target="_blank">Laughing</a>
                </div>
            </div>
            <div class="dropdown">
                <button id="navGamesLink" class="dropbtn" aria-label="Games Menu" tabindex="0">Games</button>
                <div class="dropdown-content">
                    <a href="#" id="flippingGameLink" aria-label="KiteAI Flipping Game">KiteAI Flipping</a>
                    <a href="#" id="shootingGameLink" aria-label="KiteAI Shooting Game">KiteAI Shooting</a>
                </div>
            </div>
        </div>
        <button class="sidebar-btn" aria-label="Toggle Menu" tabindex="0">â˜°</button>
    </nav>

    <!-- Sidebar (Mobile) -->
    <div class="sidebar" id="sidebarMenu">
        <a href="https://testnet.gokite.ai?referralCode=XDO80HYV" target="_blank">KiteAI Testnet</a>
        <a href="https://opensea.io/collection/fly-the-kite-official" target="_blank">NFTs</a>
        <a href="https://x.com/ChiZhangData" target="_blank">Co-founder</a>
        <a href="https://x.com/Kite_Frens_Eco" target="_blank">Community & Ecosystem</a>
        <a href="https://x.com/KiteAIChinese" target="_blank">KiteAI Chinese</a>
        <a href="https://x.com/buidloor" target="_blank">Vikthebuilder</a>
        <a href="https://x.com/lei_lei0904" target="_blank">Lei-Lei</a>
        <a href="https://x.com/scottshics" target="_blank">Scott Shi</a>
        <a href="https://x.com/Henryleemr" target="_blank">Henry Lee</a>
        <a href="https://x.com/superamscom" target="_blank">Spring</a>
        <a href="https://x.com/0xLaughing" target="_blank">Laughing</a>
    </div>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Games Modal -->
    <div id="gamesModal" class="modal" role="dialog" aria-labelledby="gamesTitle">
        <div class="modal-content">
            <img class="modal-close" id="closeGamesBtn" src="https://i.postimg.cc/6TkVmjdM/close-icon.png" alt="Close Games" aria-label="Close Games" role="button" tabindex="0">
            <h2 id="gamesTitle">KiteAI Games</h2>
            <a href="#" class="game-option" id="flippingGameOption" aria-label="KiteAI Flipping Game">KiteAI Flipping</a>
            <a href="#" class="game-option" id="shootingGameOption" aria-label="KiteAI Shooting Game">KiteAI Shooting</a>
        </div>
    </div>

    <!-- Announcement Modal -->
    <div id="announcementModal" class="modal" role="dialog" aria-labelledby="announcementTitle">
        <div class="modal-content">
            <img class="modal-close" id="closeAnnouncementBtn" src="https://i.postimg.cc/6TkVmjdM/close-icon.png" alt="Close Announcements" aria-label="Close Announcements" role="button" tabindex="0">
            <h2 id="announcementTitle" class="visually-hidden">Announcements</h2>
            <div id="tweetContainer" style="text-align: center;"></div>
            <div class="announcement-controls">
                <span id="prevBtn" aria-label="Previous Tweet" role="button" tabindex="0">â‡š</span>
                <span id="nextBtn" aria-label="Next Tweet" role="button" tabindex="0">â‡›</span>
            </div>
        </div>
    </div>

    <!-- Flipping Game Modal -->
    <div id="gameModal" class="modal" role="dialog" aria-labelledby="gameTitle">
        <div id="gameContent" class="modal-content">
            <img class="modal-close" id="closeGameBtn" src="https://i.postimg.cc/6TkVmjdM/close-icon.png" alt="Close Game" aria-label="Close Game" role="button" tabindex="0">
            <div id="gameTitle">KiteAI Flipping Game</div>
            <div class="game-controls">
                <div id="gameScore" aria-live="polite">Level: 1 | Best Level: 1 | Moves: 0</div>
                <button id="restartGameBtn" aria-label="Restart Game">Restart</button>
                <button id="nextLevelBtn" style="display: none;" aria-label="Next Level">Next Level</button>
            </div>
            <div id="puzzleGrid"></div>
            <div id="winMessage" aria-live="assertive">Level Completed!</div>
        </div>
    </div>

    <!-- Shooting Game Modal -->
    <div id="shootingGameModal" class="modal" role="dialog" aria-labelledby="shootingGameTitle">
        <div id="shootingGameContent" class="modal-content">
            <img class="modal-close" id="closeShootingGameBtn" src="https://i.postimg.cc/6TkVmjdM/close-icon.png" alt="Close Shooting Game" aria-label="Close Shooting Game" role="button" tabindex="0">
            <div id="shootingGameTitle">KiteAI Shooting Game</div>
            <div class="game-controls-shooting">
                <div id="shootingGameScore" aria-live="polite">Level: 1 | Score: 0 | Lives: 3</div>
                <button id="scopeToggleBtn" aria-label="Toggle Scope">Toggle Scope</button>
                <button id="restartShootingGameBtn" aria-label="Restart Shooting Game">Restart</button>
            </div>
            <canvas id="shootingGameCanvas"></canvas>
            <div id="gameOverMessage" aria-live="assertive">Game Over!</div>
        </div>
    </div>

    <!-- Feedback Form -->
    <form id="feedbackForm" class="feedback-form" action="https://formspree.io/f/xzzvwrap" method="POST">
        <h2>Community Feedback</h2>
        <select name="category" required aria-label="Select Feedback Category">
            <option value="">Select Category</option>
            <option value="Community Feedback">Community Feedback</option>
            <option value="Error Report">Error / Issue</option>
            <option value="Event or Campaign">Event / Campaign</option>
        </select>
        <textarea name="message" rows="4" placeholder="Your feedback..." required aria-label="Feedback Message"></textarea>
        <input type="email" name="email" placeholder="Your Email" required aria-label="Your Email">
        <button type="submit" id="submitBtn" aria-label="Submit Feedback">Send Feedback</button>
        <div class="form-buttons">
            <button type="button" id="announcementBtn" aria-label="Open Announcements">ðŸ“¢ Announcements</button>
            <button type="button" id="agentBtn" aria-label="Open Community Agent">ðŸ¤– Community Agent</button>
            <button type="button" id="gamesBtn" aria-label="Open Games">ðŸŽ® Games</button>
        </div>
    </form>

    <!-- Agent Chat Modal -->
    <div id="agentModal" class="modal" role="dialog" aria-labelledby="agentTitle">
        <div id="agentContent" class="modal-content">
            <img class="modal-close" id="closeAgentBtn" src="https://i.postimg.cc/6TkVmjdM/close-icon.png" alt="Close Chat" aria-label="Close Chat" role="button" tabindex="0">
            <h2 id="agentTitle" class="visually-hidden">Community Agent</h2>
            <div id="chatMessages" aria-live="polite"></div>
            <div id="preQuestions">
                <button class="question-btn" aria-label="How to use KiteAI">How can I use KiteAI?</button>
                <button class="question-btn" aria-label="What are KiteAI NFTs">What are KiteAI NFTs?</button>
                <button class="question-btn" aria-label="Join KiteAI community">How to join KiteAI community?</button>
                <button class="question-btn" aria-label="Report an issue">How to report an issue?</button>
                <button class="question-btn" aria-label="Upcoming events">Upcoming events in KiteAI?</button>
            </div>
            <input type="text" id="userInput" placeholder="Ask a question..." aria-label="Type your question">
            <button id="sendBtn" aria-label="Send Message">Send</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast" role="alert" aria-live="assertive"></div>

    <!-- Footer -->
    <footer>
        <img src="https://i.postimg.cc/mzMZpf0r/logo.jpg" alt="KiteAI Logo">
        <span>Made for KiteAI Â· Follow
            <a href="https://x.com/Crypto_King877" target="_blank" aria-label="Follow Crypto_King877">@Crypto_King877</a> &
            <a href="https://x.com/GoKiteAI" target="_blank" aria-label="Follow GoKiteAI">@GoKiteAI</a>
        </span>
    </footer>

    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Audio
            const clickSound = document.getElementById('clickSound');
            const shootSound = document.getElementById('shootSound');
            const playSound = sound => {
                sound.currentTime = 0;
                sound.play().catch(() => {});
            };
            document.querySelectorAll('button, a, .card, .modal-close, .announcement-controls span').forEach(el => {
                el.addEventListener('click', () => playSound(clickSound));
                el.addEventListener('keypress', e => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        playSound(clickSound);
                        el.click();
                    }
                });
            });

            // Sidebar
            const sidebarMenu = document.getElementById('sidebarMenu');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            document.querySelector('.sidebar-btn').addEventListener('click', () => {
                sidebarMenu.classList.toggle('show');
                sidebarOverlay.classList.toggle('show');
            });
            sidebarOverlay.addEventListener('click', () => {
                sidebarMenu.classList.remove('show');
                sidebarOverlay.classList.remove('show');
            });

            // Toast
            const showToast = (msg, duration = 3000) => {
                const toast = document.getElementById('toast');
                toast.textContent = msg;
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), duration);
            };

            // Modal Handling
            const openModal = modal => {
                modal.classList.add('show');
                const focusable = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')[0];
                if (focusable) focusable.focus();
            };
            const closeModal = modal => {
                modal.classList.remove('show');
                document.querySelector('.feedback-form').focus();
            };
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('keydown', e => {
                    if (e.key === 'Tab' && modal.classList.contains('show')) {
                        const focusable = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                        const first = focusable[0];
                        const last = focusable[focusable.length - 1];
                        if (e.shiftKey && document.activeElement === first) {
                            e.preventDefault();
                            last.focus();
                        } else if (!e.shiftKey && document.activeElement === last) {
                            e.preventDefault();
                            first.focus();
                        }
                    } else if (e.key === 'Escape') {
                        closeModal(modal);
                    }
                });
            });

            // Games Modal
            const gamesModal = document.getElementById('gamesModal');
            document.getElementById('gamesBtn').addEventListener('click', () => openModal(gamesModal));
            document.getElementById('navGamesLink').addEventListener('click', e => {
                e.preventDefault();
                openModal(gamesModal);
            });
            document.getElementById('closeGamesBtn').addEventListener('click', () => closeModal(gamesModal));

            // Announcement Modal
            const tweets = [
                "https://x.com/GoKiteAI/status/1951245795216200146",
                "https://x.com/GoKiteAI/status/1955919782785503588",
                "https://x.com/GoKiteAI/status/1955792638948597868",
                "https://x.com/GoKiteAI/status/1955104976801349904",
                "https://x.com/wallet/status/1954052040939753923",
                "https://x.com/GoKiteAI/status/1956244265958564185"
            ];
            let currentTweet = 0;
            const loadTweet = index => {
                const container = document.getElementById('tweetContainer');
                container.innerHTML = '<p>Loading tweet...</p>';
                try {
                    twttr.widgets.createTweet(tweets[index].split('/status/')[1].split('?')[0], container, { align: 'center' })
                        .then(() => container.querySelectorAll('a').forEach(link => link.addEventListener('click', () => playSound(clickSound))))
                        .catch(() => container.innerHTML = '<p>Unable to load tweet. Please try again later.</p>');
                } catch (e) {
                    container.innerHTML = '<p>Unable to load tweet. Please try again later.</p>';
                }
            };
            document.getElementById('announcementBtn').addEventListener('click', () => {
                openModal(document.getElementById('announcementModal'));
                loadTweet(currentTweet);
            });
            document.getElementById('closeAnnouncementBtn').addEventListener('click', () => closeModal(document.getElementById('announcementModal')));
            document.getElementById('prevBtn').addEventListener('click', () => {
                currentTweet = (currentTweet - 1 + tweets.length) % tweets.length;
                loadTweet(currentTweet);
            });
            document.getElementById('nextBtn').addEventListener('click', () => {
                currentTweet = (currentTweet + 1) % tweets.length;
                loadTweet(currentTweet);
            });

            // Agent Chat
            const agentModal = document.getElementById('agentModal');
            const chatMessages = document.getElementById('chatMessages');
            const userInput = document.getElementById('userInput');
            const answers = {
                'how can i use kiteai?': 'Join the KiteAI Testnet at testnet.gokite.ai!',
                'what are kiteai nfts?': 'KiteAI NFTs are collectibles on OpenSea with community perks.',
                'how to join kiteai community?': 'Follow @GoKiteAI and @Kite_Frens_Eco on X!',
                'how to report an issue?': 'Use the feedback form or DM @GoKiteAI on X.',
                'upcoming events in kiteai?': 'Check @GoKiteAI on X for events and campaigns!'
            };
            const addMessage = (text, sender) => {
                const div = document.createElement('div');
                div.classList.add('chat-msg', `chat-${sender}`);
                div.textContent = text;
                chatMessages.appendChild(div);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            };
            document.getElementById('agentBtn').addEventListener('click', () => {
                openModal(agentModal);
                userInput.focus();
            });
            document.getElementById('closeAgentBtn').addEventListener('click', () => closeModal(agentModal));
            document.querySelectorAll('.question-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const q = btn.textContent;
                    addMessage(q, 'user');
                    addMessage(answers[q.toLowerCase()] || 'Thanks for your question!', 'agent');
                });
            });
            document.getElementById('sendBtn').addEventListener('click', () => {
                const q = userInput.value.trim();
                if (q) {
                    addMessage(q, 'user');
                    addMessage(answers[q.toLowerCase()] || 'Thanks for your question!', 'agent');
                    userInput.value = '';
                } else {
                    showToast('Please enter a question!', 3000);
                }
            });
            userInput.addEventListener('keypress', e => {
                if (e.key === 'Enter') document.getElementById('sendBtn').click();
            });

            // Flipping Game
            const gameModal = document.getElementById('gameModal');
            const puzzleGrid = document.getElementById('puzzleGrid');
            const gameScore = document.getElementById('gameScore');
            const winMessage = document.getElementById('winMessage');
            const baseImages = [
                'https://i.postimg.cc/FfpWLBgg/image1.png',
                'https://i.postimg.cc/68NY1XMf/image2.png',
                'https://i.postimg.cc/PNpyXxcM/image3.png',
                'https://i.postimg.cc/mzMZpf0r/logo.jpg',
                'https://i.postimg.cc/zyBhrQMg/target.png'
            ];
            const backsideImage = 'https://i.postimg.cc/6TkVmjdM/close-icon.png';
            let level = 1;
            let bestLevel = localStorage.getItem('puzzleGameBestLevel') || 1;
            let moves = 0;
            let flippedCards = [];
            let matchedSets = 0;
            let isProcessing = false;
            const maxLevels = 20;

            const getCardCount = level => {
                if (level <= 5) return 2;
                if (level <= 10) return 3;
                if (level <= 15) return 4;
                return 5;
            };

            const shuffle = array => {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            };

            const createCard = imageSrc => {
                const card = document.createElement('div');
                card.classList.add('card');
                const inner = document.createElement('div');
                inner.classList.add('card-inner');
                const front = document.createElement('div');
                front.classList.add('card-front');
                const frontImg = document.createElement('img');
                frontImg.src = imageSrc;
                frontImg.alt = 'Card Image';
                frontImg.onerror = () => frontImg.src = 'https://via.placeholder.com/80?text=Card';
                front.appendChild(frontImg);
                const back = document.createElement('div');
                back.classList.add('card-back');
                const backImg = document.createElement('img');
                backImg.src = backsideImage;
                backImg.alt = 'Card Back';
                backImg.onerror = () => backImg.src = 'https://via.placeholder.com/80?text=Back';
                back.appendChild(backImg);
                inner.appendChild(front);
                inner.appendChild(back);
                card.appendChild(inner);
                card.addEventListener('click', handleCardClick);
                card.addEventListener('keypress', e => {
                    if (e.key === 'Enter' || e.key === ' ') handleCardClick(e);
                });
                card.tabIndex = 0;
                return card;
            };

            const initPuzzle = () => {
                puzzleGrid.innerHTML = '';
                winMessage.classList.remove('show');
                puzzleGrid.classList.remove('won');
                const cardCount = getCardCount(level);
                const selectedImages = baseImages.slice(0, cardCount);
                const frontImages = [].concat(...selectedImages.map(img => Array(3).fill(img)));
                const shuffledImages = shuffle(frontImages);
                puzzleGrid.style.gridTemplateColumns = `repeat(${Math.ceil(Math.sqrt(shuffledImages.length))}, 1fr)`;
                shuffledImages.forEach(src => puzzleGrid.appendChild(createCard(src)));
                flippedCards = [];
                matchedSets = 0;
                moves = 0;
                isProcessing = false;
                gameScore.textContent = `Level: ${level} | Best Level: ${bestLevel} | Moves: ${moves}`;
                document.getElementById('nextLevelBtn').style.display = 'none';
            };

            const handleCardClick = e => {
                e.preventDefault();
                if (isProcessing || puzzleGrid.classList.contains('won')) return;
                const card = e.target.closest('.card');
                if (!card || card.classList.contains('flipped') || flippedCards.length >= 3) return;
                card.classList.add('flipped');
                flippedCards.push(card);
                moves++;
                gameScore.textContent = `Level: ${level} | Best Level: ${bestLevel} | Moves: ${moves}`;
                playSound(clickSound);
                if (flippedCards.length === 3) {
                    isProcessing = true;
                    checkMatch();
                }
            };

            const checkMatch = () => {
                const fronts = flippedCards.map(card => card.querySelector('.card-front img').src);
                if (fronts[0] === fronts[1] && fronts[1] === fronts[2]) {
                    matchedSets++;
                    flippedCards = [];
                    isProcessing = false;
                    if (matchedSets === getCardCount(level)) {
                        puzzleGrid.classList.add('won');
                        winMessage.textContent = level === maxLevels ? 'All Levels Completed!' : `Level ${level} Completed!`;
                        winMessage.classList.add('show');
                        showToast(level === maxLevels ? 'Congratulations! All Levels Done!' : `Level ${level} Completed!`, 4000);
                        if (level > bestLevel) {
                            bestLevel = level;
                            localStorage.setItem('puzzleGameBestLevel', bestLevel);
                        }
                        document.getElementById('nextLevelBtn').style.display = level < maxLevels ? 'block' : 'none';
                    }
                } else {
                    setTimeout(() => {
                        flippedCards.forEach(card => card.classList.remove('flipped'));
                        flippedCards = [];
                        isProcessing = false;
                    }, 1000 - (level - 1) * 40);
                }
            };

            document.getElementById('flippingGameOption').addEventListener('click', e => {
                e.preventDefault();
                closeModal(gamesModal);
                openModal(gameModal);
                level = 1;
                initPuzzle();
            });
            document.getElementById('closeGameBtn').addEventListener('click', () => closeModal(gameModal));
            document.getElementById('restartGameBtn').addEventListener('click', () => {
                level = 1;
                initPuzzle();
            });
            document.getElementById('nextLevelBtn').addEventListener('click', () => {
                level = level < maxLevels ? level + 1 : 1;
                initPuzzle();
            });

            // Shooting Game
            const shootingGameModal = document.getElementById('shootingGameModal');
            const shootingGameCanvas = document.getElementById('shootingGameCanvas');
            const shootingGameScore = document.getElementById('shootingGameScore');
            const gameOverMessage = document.getElementById('gameOverMessage');
            const ctx = shootingGameCanvas.getContext('2d');
            let level = 1;
            let score = 0;
            let lives = 3;
            let bestScore = localStorage.getItem('shootingGameBestScore') || 0;
            let targets = [];
            let isScopeActive = false;
            let isGameOver = false;
            let gameLoop = null;
            let mouseX = null;
            let mouseY = null;
            const gunImage = new Image();
            gunImage.src = 'https://i.postimg.cc/LnrJcszr/gun.png';
            gunImage.onerror = () => gunImage.src = 'https://via.placeholder.com/80x48?text=Gun';
            const scopeImage = new Image();
            scopeImage.src = 'https://i.postimg.cc/yDVMYmX9/scope.png';
            scopeImage.onerror = () => scopeImage.src = 'https://via.placeholder.com/80?text=Scope';
            const targetImage = new Image();
            targetImage.src = 'https://i.postimg.cc/zyBhrQMg/target.png';
            targetImage.onerror = () => targetImage.src = 'https://via.placeholder.com/40?text=Target';

            const resizeCanvas = () => {
                const parent = shootingGameCanvas.parentElement;
                shootingGameCanvas.width = parent.clientWidth > 600 ? 600 : parent.clientWidth;
                shootingGameCanvas.height = window.innerWidth <= 767 ? 250 : 400;
            };
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            const createTarget = () => {
                const size = Math.random() * 15 + 20;
                const x = Math.random() * (shootingGameCanvas.width - size);
                const y = Math.random() * (shootingGameCanvas.height - size - 48);
                const speed = 1 + level * 0.3;
                targets.push({ x, y, size, vx: (Math.random() - 0.5) * speed, vy: (Math.random() - 0.5) * speed, spawnTime: Date.now() });
            };

            const hitTarget = (x, y) => {
                let hit = false;
                targets = targets.filter(t => {
                    const dx = x - (t.x + t.size / 2);
                    const dy = y - (t.y + t.size / 2);
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance < t.size / 2) {
                        hit = true;
                        const timeTaken = (Date.now() - t.spawnTime) / 1000;
                        const points = isScopeActive ? Math.max(20, 80 - Math.floor(timeTaken * 10)) : Math.max(10, 40 - Math.floor(timeTaken * 5));
                        score += points;
                        showToast(`Hit! +${points} points`, 1000);
                        const hitEffect = document.createElement('div');
                        hitEffect.classList.add('hit-effect');
                        hitEffect.style.left = `${x - 6}px`;
                        hitEffect.style.top = `${y - 6}px`;
                        shootingGameCanvas.parentElement.appendChild(hitEffect);
                        setTimeout(() => hitEffect.remove(), 500);
                        return false;
                    }
                    return true;
                });
                if (!hit && lives > 0) {
                    lives--;
                    showToast(`Miss! Lives: ${lives}`, 1000);
                    if (lives === 0) endShootingGame();
                }
                if (hit) playSound(shootSound);
                shootingGameScore.textContent = `Level: ${level} | Score: ${score} | Lives: ${lives}`;
                return hit;
            };

            const updateTargets = () => {
                const now = Date.now();
                targets = targets.filter(t => now - t.spawnTime <= 3500 - level * 80);
                if (targets.length < 2 + level && Math.random() < 0.1) createTarget();
                targets.forEach(t => {
                    t.x += t.vx;
                    t.y += t.vy;
                    if (t.x < 0 || t.x > shootingGameCanvas.width - t.size) t.vx *= -1;
                    if (t.y < 0 || t.y > shootingGameCanvas.height - t.size - 48) t.vy *= -1;
                });
                if (score >= level * 80 && level < maxLevels) {
                    level++;
                    showToast(`Level ${level} Unlocked!`, 2000);
                }
            };

            const drawGame = () => {
                ctx.clearRect(0, 0, shootingGameCanvas.width, shootingGameCanvas.height);
                const gradient = ctx.createLinearGradient(0, 0, 0, shootingGameCanvas.height);
                gradient.addColorStop(0, '#1a2338');
                gradient.addColorStop(1, '#334155');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, shootingGameCanvas.width, shootingGameCanvas.height);
                targets.forEach(t => ctx.drawImage(targetImage, t.x, t.y, t.size, t.size));
                ctx.drawImage(gunImage, mouseX ? mouseX - 40 : shootingGameCanvas.width / 2 - 40, shootingGameCanvas.height - 48, 80, 48);
                if (isScopeActive && mouseX !== null && mouseY !== null) {
                    ctx.drawImage(scopeImage, mouseX - 40, mouseY - 40, 80, 80);
                }
            };

            const endShootingGame = () => {
                isGameOver = true;
                gameOverMessage.classList.add('show');
                shootingGameCanvas.style.filter = 'blur(4px)';
                if (score > bestScore) {
                    bestScore = score;
                    localStorage.setItem('shootingGameBestScore', bestScore);
                }
                showToast(`Game Over! Score: ${score}`, 4000);
                cancelAnimationFrame(gameLoop);
            };

            const initShootingGame = () => {
                resizeCanvas();
                level = 1;
                score = 0;
                lives = 3;
                targets = [];
                isGameOver = false;
                isScopeActive = false;
                shootingGameCanvas.style.cursor = 'crosshair';
                shootingGameCanvas.style.filter = 'none';
                gameOverMessage.classList.remove('show');
                shootingGameScore.textContent = `Level: ${level} | Score: ${score} | Lives: ${lives}`;
                createTarget();
                gameLoop = requestAnimationFrame(gameLoopFunction);
            };

            const gameLoopFunction = () => {
                if (!isGameOver) {
                    updateTargets();
                    drawGame();
                    gameLoop = requestAnimationFrame(gameLoopFunction);
                }
            };

            shootingGameCanvas.addEventListener('mousemove', e => {
                if (isGameOver) return;
                const rect = shootingGameCanvas.getBoundingClientRect();
                mouseX = (e.clientX - rect.left) * (shootingGameCanvas.width / rect.width);
                mouseY = (e.clientY - rect.top) * (shootingGameCanvas.height / rect.height);
            });
            shootingGameCanvas.addEventListener('click', e => {
                if (isGameOver) return;
                const rect = shootingGameCanvas.getBoundingClientRect();
                const x = (e.clientX - rect.left) * (shootingGameCanvas.width / rect.width);
                const y = (e.clientY - rect.top) * (shootingGameCanvas.height / rect.height);
                hitTarget(x, y);
            });
            document.getElementById('scopeToggleBtn').addEventListener('click', () => {
                if (isGameOver) return;
                isScopeActive = !isScopeActive;
                shootingGameCanvas.style.cursor = isScopeActive ? 'none' : 'crosshair';
                showToast(isScopeActive ? 'Scope On' : 'Scope Off', 2000);
            });
            document.getElementById('shootingGameOption').addEventListener('click', e => {
                e.preventDefault();
                closeModal(gamesModal);
                openModal(shootingGameModal);
                initShootingGame();
            });
            document.getElementById('closeShootingGameBtn').addEventListener('click', () => {
                closeModal(shootingGameModal);
                cancelAnimationFrame(gameLoop);
            });
            document.getElementById('restartShootingGameBtn').addEventListener('click', initShootingGame);

            // Form Handling
            document.getElementById('feedbackForm').addEventListener('submit', e => {
                e.preventDefault();
                const form = e.target;
                const submitBtn = document.getElementById('submitBtn');
                const category = form.category.value;
                const message = form.message.value.trim();
                const email = form.email.value.trim();
                const emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,}$/;
                if (!category || !message || !email) return showToast('Please fill all fields!', 3000);
                if (!emailRegex.test(email)) return showToast('Invalid email address!', 3000);
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitting...';
                fetch(form.action, {
                    method: 'POST',
                    body: new FormData(form),
                    headers: { 'Accept': 'application/json' }
                }).then(res => {
                    if (res.ok) {
                        showToast('Feedback sent! Thank you!', 4000);
                        form.reset();
                    } else {
                        showToast('Error submitting feedback!', 4000);
                    }
                }).catch(() => showToast('Network error!', 4000)).finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Send Feedback';
                });
            });

            // Real-time Form Validation
            document.querySelectorAll('#feedbackForm input, #feedbackForm textarea, #feedbackForm select').forEach(input => {
                input.addEventListener('input', () => {
                    input.style.borderColor = input.value.trim() ? '#3b82f6' : 'rgba(255, 255, 255, 0.2)';
                });
            });
        });
    </script>
</body>
</html>
